{% extends 'layout/base.html' %}

{% block title %}Thanh Toán Đặt Lịch{% endblock %}

{# Ẩn thanh tìm kiếm trên trang thanh toán #}
{% block search_bar %}{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-primary text-white text-center py-3">
          <h2 class="mb-0">Xác Nhận Thanh Toán</h2>
          <p class="mb-0">Vui lòng kiểm tra thông tin chi tiết và tiến hành thanh toán.</p>
        </div>
        <div class="card-body p-4">
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="alert alert-{{ category }} mt-3">{{ message }}</div>
              {% endfor %}
            {% endif %}
          {% endwith %}

          {% if ticket %}
          <h4 class="mb-3 text-center">Thông Tin Lịch Hẹn</h4>
          <ul class="list-group mb-4">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <strong>Mã Vé:</strong>
              <span>{{ ticket.uuid }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <strong>Bác Sĩ:</strong>
              <span>{{ ticket.doctor_shift.doctor.first_name }} {{ ticket.doctor_shift.doctor.last_name }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <strong>Chuyên Khoa:</strong>
              <span>
                {% if ticket.doctor_shift.doctor.specialties %}
                  {{ ticket.doctor_shift.doctor.specialties | map(attribute='name') | join(', ') }}
                {% else %}
                  Đang cập nhật
                {% endif %}
              </span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <strong>Ngày Khám:</strong>
              <span>{{ ticket.doctor_shift.work_date.strftime('%d/%m/%Y') }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <strong>Giờ Khám:</strong>
              <span>{{ ticket.doctor_shift.shift.start_time.strftime('%H:%M') }} - {{ ticket.doctor_shift.shift.end_time.strftime('%H:%M') }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <strong>Trung Tâm Y Tế:</strong>
              <span>{{ ticket.doctor_shift.doctor.medical_center.name }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <strong>Địa chỉ:</strong>
              <span>{{ ticket.doctor_shift.doctor.medical_center.address }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <strong>Tên Bệnh Nhân:</strong>
              <span>{{ ticket.first_name }} {{ ticket.last_name }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <strong>Trạng Thái:</strong>
              <span class="badge {% if ticket.status.value == 'pending' %}bg-warning{% elif ticket.status.value == 'confirmed' %}bg-success{% else %}bg-secondary{% endif %}">{{ ticket.status.value.capitalize() }}</span>
            </li>
          </ul>

          <div class="text-center mt-4">
            {# Đây là nơi bạn sẽ thêm logic thanh toán thực tế #}
            <p class="lead">Tổng tiền cần thanh toán: <strong class="text-danger">500.000 VNĐ</strong> (Ví dụ)</p>
            <button class="btn btn-success btn-lg mx-2"><i class="fas fa-money-bill-wave mr-2"></i> Thanh Toán Ngay</button>
            <a href="{{ url_for('home') }}" class="btn btn-outline-secondary btn-lg mx-2"><i class="fas fa-times-circle mr-2"></i> Hủy Bỏ</a>
          </div>

          {% else %}
          <div class="alert alert-danger text-center" role="alert">
            Không tìm thấy thông tin vé đặt lịch. Vui lòng thử lại.
          </div>
          {% endif %}
        </div>
        <div class="card-footer text-muted text-center py-3">
          Cảm ơn bạn đã tin tưởng dịch vụ của chúng tôi!
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}